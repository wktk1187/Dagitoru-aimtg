/* esm.sh - @supabase/storage-js@2.7.1 */
import { Buffer as __Buffer$ } from "node:buffer";
var g=class extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}};function l(o){return typeof o=="object"&&o!==null&&"__isStorageError"in o}var x=class extends g{constructor(r,t){super(r),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}},v=class extends g{constructor(r,t){super(r),this.name="StorageUnknownError",this.originalError=t}};var L=function(o,r,t,e){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function d(c){try{u(e.next(c))}catch(h){a(h)}}function s(c){try{u(e.throw(c))}catch(h){a(h)}}function u(c){c.done?i(c.value):n(c.value).then(d,s)}u((e=e.apply(o,r||[])).next())})},S=o=>{let r;return o?r=o:typeof fetch>"u"?r=(...t)=>import("/@supabase/node-fetch@^2.6.14?target=denonext").then(({default:e})=>e(...t)):r=fetch,(...t)=>r(...t)},T=()=>L(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("/@supabase/node-fetch@^2.6.14?target=denonext")).Response:Response}),O=o=>{if(Array.isArray(o))return o.map(t=>O(t));if(typeof o=="function"||o!==Object(o))return o;let r={};return Object.entries(o).forEach(([t,e])=>{let n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));r[n]=O(e)}),r};var y=function(o,r,t,e){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function d(c){try{u(e.next(c))}catch(h){a(h)}}function s(c){try{u(e.throw(c))}catch(h){a(h)}}function u(c){c.done?i(c.value):n(c.value).then(d,s)}u((e=e.apply(o,r||[])).next())})},k=o=>o.msg||o.message||o.error_description||o.error||JSON.stringify(o),A=(o,r,t)=>y(void 0,void 0,void 0,function*(){let e=yield T();o instanceof e&&!t?.noResolveJson?o.json().then(n=>{r(new x(k(n),o.status||500))}).catch(n=>{r(new v(k(n),n))}):r(new v(k(o),o))}),B=(o,r,t,e)=>{let n={method:o,headers:r?.headers||{}};return o==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},r?.headers),e&&(n.body=JSON.stringify(e)),Object.assign(Object.assign({},n),t))};function _(o,r,t,e,n,i){return y(this,void 0,void 0,function*(){return new Promise((a,d)=>{o(t,B(r,e,n,i)).then(s=>{if(!s.ok)throw s;return e?.noResolveJson?s:s.json()}).then(s=>a(s)).catch(s=>A(s,d,e))})})}function w(o,r,t,e){return y(this,void 0,void 0,function*(){return _(o,"GET",r,t,e)})}function p(o,r,t,e,n){return y(this,void 0,void 0,function*(){return _(o,"POST",r,e,n,t)})}function F(o,r,t,e,n){return y(this,void 0,void 0,function*(){return _(o,"PUT",r,e,n,t)})}function P(o,r,t,e){return y(this,void 0,void 0,function*(){return _(o,"HEAD",r,Object.assign(Object.assign({},t),{noResolveJson:!0}),e)})}function E(o,r,t,e,n){return y(this,void 0,void 0,function*(){return _(o,"DELETE",r,e,n,t)})}var f=function(o,r,t,e){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function d(c){try{u(e.next(c))}catch(h){a(h)}}function s(c){try{u(e.throw(c))}catch(h){a(h)}}function u(c){c.done?i(c.value):n(c.value).then(d,s)}u((e=e.apply(o,r||[])).next())})},q={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},R={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},$=class{constructor(r,t={},e,n){this.url=r,this.headers=t,this.bucketId=e,this.fetch=S(n)}uploadOrUpdate(r,t,e,n){return f(this,void 0,void 0,function*(){try{let i,a=Object.assign(Object.assign({},R),n),d=Object.assign(Object.assign({},this.headers),r==="POST"&&{"x-upsert":String(a.upsert)}),s=a.metadata;typeof Blob<"u"&&e instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),s&&i.append("metadata",this.encodeMetadata(s)),i.append("",e)):typeof FormData<"u"&&e instanceof FormData?(i=e,i.append("cacheControl",a.cacheControl),s&&i.append("metadata",this.encodeMetadata(s))):(i=e,d["cache-control"]=`max-age=${a.cacheControl}`,d["content-type"]=a.contentType,s&&(d["x-metadata"]=this.toBase64(this.encodeMetadata(s)))),n?.headers&&(d=Object.assign(Object.assign({},d),n.headers));let u=this._removeEmptyFolders(t),c=this._getFinalPath(u),h=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:r,body:i,headers:d},a?.duplex?{duplex:a.duplex}:{})),m=yield h.json();return h.ok?{data:{path:u,id:m.Id,fullPath:m.Key},error:null}:{data:null,error:m}}catch(i){if(l(i))return{data:null,error:i};throw i}})}upload(r,t,e){return f(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",r,t,e)})}uploadToSignedUrl(r,t,e,n){return f(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(r),a=this._getFinalPath(i),d=new URL(this.url+`/object/upload/sign/${a}`);d.searchParams.set("token",t);try{let s,u=Object.assign({upsert:R.upsert},n),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&e instanceof Blob?(s=new FormData,s.append("cacheControl",u.cacheControl),s.append("",e)):typeof FormData<"u"&&e instanceof FormData?(s=e,s.append("cacheControl",u.cacheControl)):(s=e,c["cache-control"]=`max-age=${u.cacheControl}`,c["content-type"]=u.contentType);let h=yield this.fetch(d.toString(),{method:"PUT",body:s,headers:c}),m=yield h.json();return h.ok?{data:{path:i,fullPath:m.Key},error:null}:{data:null,error:m}}catch(s){if(l(s))return{data:null,error:s};throw s}})}createSignedUploadUrl(r,t){return f(this,void 0,void 0,function*(){try{let e=this._getFinalPath(r),n=Object.assign({},this.headers);t?.upsert&&(n["x-upsert"]="true");let i=yield p(this.fetch,`${this.url}/object/upload/sign/${e}`,{},{headers:n}),a=new URL(this.url+i.url),d=a.searchParams.get("token");if(!d)throw new g("No token returned by API");return{data:{signedUrl:a.toString(),path:r,token:d},error:null}}catch(e){if(l(e))return{data:null,error:e};throw e}})}update(r,t,e){return f(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",r,t,e)})}move(r,t,e){return f(this,void 0,void 0,function*(){try{return{data:yield p(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:r,destinationKey:t,destinationBucket:e?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(l(n))return{data:null,error:n};throw n}})}copy(r,t,e){return f(this,void 0,void 0,function*(){try{return{data:{path:(yield p(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:r,destinationKey:t,destinationBucket:e?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(l(n))return{data:null,error:n};throw n}})}createSignedUrl(r,t,e){return f(this,void 0,void 0,function*(){try{let n=this._getFinalPath(r),i=yield p(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},e?.transform?{transform:e.transform}:{}),{headers:this.headers}),a=e?.download?`&download=${e.download===!0?"":e.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(n){if(l(n))return{data:null,error:n};throw n}})}createSignedUrls(r,t,e){return f(this,void 0,void 0,function*(){try{let n=yield p(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:r},{headers:this.headers}),i=e?.download?`&download=${e.download===!0?"":e.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(n){if(l(n))return{data:null,error:n};throw n}})}download(r,t){return f(this,void 0,void 0,function*(){let n=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),a=i?`?${i}`:"";try{let d=this._getFinalPath(r);return{data:yield(yield w(this.fetch,`${this.url}/${n}/${d}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(d){if(l(d))return{data:null,error:d};throw d}})}info(r){return f(this,void 0,void 0,function*(){let t=this._getFinalPath(r);try{let e=yield w(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:O(e),error:null}}catch(e){if(l(e))return{data:null,error:e};throw e}})}exists(r){return f(this,void 0,void 0,function*(){let t=this._getFinalPath(r);try{return yield P(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(e){if(l(e)&&e instanceof v){let n=e.originalError;if([400,404].includes(n?.status))return{data:!1,error:e}}throw e}})}getPublicUrl(r,t){let e=this._getFinalPath(r),n=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);let d=typeof t?.transform<"u"?"render/image":"object",s=this.transformOptsToQueryString(t?.transform||{});s!==""&&n.push(s);let u=n.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${d}/public/${e}${u}`)}}}remove(r){return f(this,void 0,void 0,function*(){try{return{data:yield E(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:r},{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}list(r,t,e){return f(this,void 0,void 0,function*(){try{let n=Object.assign(Object.assign(Object.assign({},q),t),{prefix:r||""});return{data:yield p(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},e),error:null}}catch(n){if(l(n))return{data:null,error:n};throw n}})}encodeMetadata(r){return JSON.stringify(r)}toBase64(r){return typeof __Buffer$<"u"?__Buffer$.from(r).toString("base64"):btoa(r)}_getFinalPath(r){return`${this.bucketId}/${r}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){let t=[];return r.width&&t.push(`width=${r.width}`),r.height&&t.push(`height=${r.height}`),r.resize&&t.push(`resize=${r.resize}`),r.format&&t.push(`format=${r.format}`),r.quality&&t.push(`quality=${r.quality}`),t.join("&")}};var C="2.7.1";var I={"X-Client-Info":`storage-js/${C}`};var b=function(o,r,t,e){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function d(c){try{u(e.next(c))}catch(h){a(h)}}function s(c){try{u(e.throw(c))}catch(h){a(h)}}function u(c){c.done?i(c.value):n(c.value).then(d,s)}u((e=e.apply(o,r||[])).next())})},j=class{constructor(r,t={},e){this.url=r,this.headers=Object.assign(Object.assign({},I),t),this.fetch=S(e)}listBuckets(){return b(this,void 0,void 0,function*(){try{return{data:yield w(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(r){if(l(r))return{data:null,error:r};throw r}})}getBucket(r){return b(this,void 0,void 0,function*(){try{return{data:yield w(this.fetch,`${this.url}/bucket/${r}`,{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}createBucket(r,t={public:!1}){return b(this,void 0,void 0,function*(){try{return{data:yield p(this.fetch,`${this.url}/bucket`,{id:r,name:r,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(l(e))return{data:null,error:e};throw e}})}updateBucket(r,t){return b(this,void 0,void 0,function*(){try{return{data:yield F(this.fetch,`${this.url}/bucket/${r}`,{id:r,name:r,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(l(e))return{data:null,error:e};throw e}})}emptyBucket(r){return b(this,void 0,void 0,function*(){try{return{data:yield p(this.fetch,`${this.url}/bucket/${r}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}deleteBucket(r){return b(this,void 0,void 0,function*(){try{return{data:yield E(this.fetch,`${this.url}/bucket/${r}`,{},{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}};var U=class extends j{constructor(r,t={},e){super(r,t,e)}from(r){return new $(this.url,this.headers,r,this.fetch)}};export{x as StorageApiError,U as StorageClient,g as StorageError,v as StorageUnknownError,l as isStorageError};
//# sourceMappingURL=storage-js.mjs.map
// denoCacheMetadata={"headers":{"cache-control":"public, max-age=31536000, immutable","server":"cloudflare","cf-cache-status":"HIT","cf-ray":"941f7c5ccf6596a6-KIX","last-modified":"Wed, 15 Jan 2025 08:30:58 GMT","alt-svc":"h3=\":443\"; ma=86400","vary":"Accept-Encoding","age":"230296","date":"Mon, 19 May 2025 00:30:27 GMT","content-type":"application/javascript; charset=utf-8","access-control-allow-origin":"*"},"url":"https://esm.sh/@supabase/storage-js@2.7.1/denonext/storage-js.mjs","time":1747614627}